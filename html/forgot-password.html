<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - GandiHub</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/forgot-password.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script type="module" src="../js/auth.js"></script>
</head>
<body class="auth-page">
    <div class="forgot-container">
        <h2>Reset Password</h2>
        <form id="forgotPasswordForm">
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" required>
            </div>
            <button type="submit" class="submit-btn" id="resetBtn">
                <i class="fas fa-paper-plane"></i> 
                <span>Send Reset Link</span>
                <div class="loader"></div>
            </button>
            <div id="successMessage" class="success-message"></div>
            <div id="errorMessage" class="error-message"></div>
        </form>
        <a href="login.html" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Login
        </a>
    </div>

    <script type="module">
        import { auth } from '../js/firebase-init.js';
        import { sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';

        const form = document.getElementById('forgotPasswordForm');
        const resetBtn = document.getElementById('resetBtn');
        const btnText = resetBtn.querySelector('span');
        const loader = resetBtn.querySelector('.loader');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;

            // Show loader
            btnText.style.display = 'none';
            loader.style.display = 'block';
            resetBtn.disabled = true;
            
            try {
                // Use actionCodeSettings for password reset
                const actionCodeSettings = {
                    url: window.location.origin + '/html/login.html',
                    // This must be true for production apps after Dynamic Links sunset
                    handleCodeInApp: true
                };
                await sendPasswordResetEmail(auth, email, actionCodeSettings);
                successMessage.textContent = 'Password reset link sent! Check your email.';
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
                form.reset();
            } catch (error) {
                errorMessage.textContent = 'Failed to send reset link. Please try again.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            } finally {
                // Hide loader
                btnText.style.display = 'block';
                loader.style.display = 'none';
                resetBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
